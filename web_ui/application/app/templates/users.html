{% extends 'layout.html' %}

{% block styles %}
    {{ super() }}
    <link rel='stylesheet' type='text/css'
          href='https://cdnjs.cloudflare.com/ajax/libs/bootstrap-table/1.12.2/bootstrap-table.min.css'>
{% endblock %}

{% block scripts %}
    {{ super() }}
    <script src='https://cdnjs.cloudflare.com/ajax/libs/bootstrap-table/1.12.2/bootstrap-table.min.js'></script>
{% endblock %}

{% block page_content %}
    <a class="btn btn-primary" data-toggle="modal" data-target="#app_modal" role="button">Add</a>
    <br>
    <br>
    <table class='table table-striped table-hover' data-pagination="true" data-toggle="table" id="formats">
        <thead>
        <tr>
            <th data-field="a" data-sortable="true">User Name</th>
            <th data-field="b" data-sortable="false">Roots</th>
            <th class="col-xs-1"></th>
        </tr>
        </thead>
        <tbody>
        {% for f in users %}
            <tr>
                <td>{{ f.username }}</td>
                <td>
					<a class="btn btn-primary" data-toggle="modal" data-target="#user_roots_view" role="button">View</a>
					<a class="btn btn-primary" data-toggle="modal" data-target="#user_roots_view" role="button">Set</a>
					<!--{{f.action_mask}}-->
				</td>
				<td>{{ macros.render_button_with_confirm(utils.icon('trash'), 'btn btn-default', url_for("Admin.delete_user", uid=f._id)) }}</td>
           </tr>
        {% endfor %}
        </tbody>
    </table>
	
	<div class='modal fade' id='app_modal' tabindex='-1' role='dialog' aria-labelledby='app_modal_label'
	 aria-hidden='true'>
	<div class='modal-dialog'>
		<div class='modal-content'>
			<div class='modal-header'>
				<button type='button' class='close' data-dismiss='modal' aria-hidden='true'>&times;</button>
				<h4 class='modal-title' id='handbook_modal_label'>Add User</h4>
			</div>
			<div class='modal-body'>
				{% call macros.render_form(create_form, action_text="Add") %}
					{{ macros.render_field(create_form.title, label_visible=False) }}
					{{ macros.render_field(create_form.password, label_visible=False) }}
					{{ macros.render_field(create_form.isAdmin, label_visible=True) }}
					{{ macros.render_field(create_form.manageParsers, label_visible=True) }}
					{{ macros.render_field(create_form.manageExprData, label_visible=True) }}
					{{ macros.render_field(create_form.viewExprData, label_visible=True) }}
					{{ macros.render_field(create_form.createFormats, label_visible=True) }}
					{{ macros.render_field(create_form.generateReports, label_visible=True) }}
				{% endcall %}
			</div>
		</div>
	</div>
    </div>
	
	<div class='user modal fade' id='user_roots_view' tabindex='-2' role='dialog' aria-labelledby='user_modal_label'
	 aria-hidden='true'>
	<div class='modal-dialog'>
		<div class='modal-content'>
			<div class='modal-header'>
				<button type='button' class='close' data-dismiss='modal' aria-hidden='true'>&times;</button>
				<h4 class='modal-title' id='handbook_modal_label'>User roots</h4>
			</div>
			<div class='modal-body'>
				{% call macros.render_form(set_form, action_text="Set") %}
					{{ macros.render_field(set_form.isAdmin, label_visible=True) }}
					{{ macros.render_field(set_form.manageParsers, label_visible=True) }}
					{{ macros.render_field(set_form.manageExprData, label_visible=True) }}
					{{ macros.render_field(set_form.viewExprData, label_visible=True) }}
					{{ macros.render_field(set_form.createFormats, label_visible=True) }}
					{{ macros.render_field(set_form.generateReports, label_visible=True) }}
				{% endcall %}
			</div>
		</div>
	</div>
    </div>
{% endblock %}