{% extends 'layout.html' %}

{% block styles %}
    {{ super() }}
    <link rel='stylesheet' type='text/css'
      href='https://cdnjs.cloudflare.com/ajax/libs/bootstrap-table/1.12.2/bootstrap-table.min.css'>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jquery-jsonview/1.2.3/jquery.jsonview.min.css">
{% endblock %}

{% block scripts %}
    {{ super() }}
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-jsonview/1.2.3/jquery.jsonview.min.js"></script>
    <script src='https://cdnjs.cloudflare.com/ajax/libs/bootstrap-table/1.12.2/bootstrap-table.min.js'></script>
    <script>
        let j = $(".json_data");
        j.JSONView(JSON.parse(j.html()));
    </script>
{% endblock %}

{% block page_content %}
    <div class='row'>
        <div class='col-xs-12'>
            <div class='btn-toolbar' role='toolbar'>
                <div class='btn-group' role='group'>
                    {% if experiments | length == 0 %}
                        {{ macros.render_button_with_confirm(utils.icon('trash'), 'btn btn-default', url_for("Batches.delete", uid=batch.uid)) }}
                    {% else %}
                        <button type='button' class='btn btn-default'
                                title='Export'>{{ utils.icon('download-alt') }}</button>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
    <div class='row'>
        <div class='col-xs-3'>
            <h3>Info</h3>
            <hr>
            <p><b>UID:</b></p> {{ batch.uid }} <br><br>
            <p><b>Creation time:</b></p> {{ batch.timestamp.strftime('%d.%m.%Y %H:%M') }} <br><br>
            <p><b>Title:</b></p> {{ batch.title }} <br><br>
            <p><b>Creator:</b></p> {{ batch.creator_name }} <br><br>
            <p><b>Meta:</b></p>
            <div class="json_data">{{ batch.meta|safe }}</div>
            <br><br>
        </div>
        <div class='col-xs-5'>
            <h3>Experiments</h3>
            <hr>
            <a class="btn btn-primary" href="{{ url_for("Experiments.create", batch_uid=batch.uid) }}"
               role="button">Add</a>
            <br><br>
            <table class='table table-striped table-hover' data-pagination="true" data-toggle="table" id="experiments">
                <thead>
                <tr>
                    <th data-field="d" data-sortable="true">UID</th>
                    <th data-field="a" data-sortable="true">Creation time</th>
                    <th data-field="b" data-sortable="true">Creator</th>
                    <th class="col-xs-1"></th>
                </tr>
                </thead>
                <tbody>
                {% for f in experiments %}
                    <tr>
                        <td>{{ f.uid }}</td>
                        <td>{{ f.timestamp.strftime('%d.%m.%Y %H:%M') }}</td>
                        <td>{{ f.creator_name }}</td>
                        <td>
                            <a class="btn btn-sm" href="{{ url_for("Experiments.view", uid=f.uid) }}"
                               role="button">{{ utils.icon('eye-open') }}</a>
                            {% if not f.locked %}
                                <span class="label label-danger">Unlocked</span>
                            {% endif %}
                        </td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>
        </div>
        <div class='col-xs-4'>
            <h3>Parsers</h3>
            <hr>
            <h4>Attached parsers</h4>
            <hr>
            <h4>Output</h4>
            Mock data: 1245
            <img width="100%" src="{{ url_for("static", filename="mock/parser_output.png") }}"/>
        </div>
    </div>
{% endblock %}